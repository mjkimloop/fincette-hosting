<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•€ì…‹ë¦¬í¬íŠ¸ - ìƒì„¸ ëŒ€ì¶œ ì„¤ê³„ì•ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* [ì—…ë°ì´íŠ¸] Noto Sans KR í°íŠ¸ ì¶”ê°€ ë° Inter í°íŠ¸ CDN */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+KR:wght@400;500;700&display=swap');
        
        /* [ì—…ë°ì´íŠ¸] í°íŠ¸ í´ë°± ì‹œìŠ¤í…œ ê°•í™” */
        body {
            font-family: 'Inter', 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif !important;
        }
        @media print {
            #selection-container, #cta-container, #print-container, #comparison-container { display: none; }
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .printable-card { margin-bottom: 32px !important; page-break-inside: avoid; break-inside: avoid; }
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto max-w-3xl p-4 sm:p-8">
        
        <div id="selection-container" class="mb-8 p-4 bg-white rounded-xl shadow-sm border border-gray-200">
            <h2 class="text-lg font-semibold text-center mb-4 text-gray-700">ë¦¬í¬íŠ¸ ë°©ì‹ ì„ íƒ</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <button onclick="renderReport('A')" class="option-button w-full p-3 font-semibold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition">A: ì‚¬ì—…ì ì£¼ë‹´ëŒ€</button>
                <button onclick="renderReport('B')" class="option-button w-full p-3 font-semibold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition">B: ì¼ë°˜ ì£¼ë‹´ëŒ€</button>
            </div>
        </div>

        <!-- ë¦¬í¬íŠ¸ê°€ í‘œì‹œë  ì˜ì—­ -->
        <div id="report-content" class="space-y-6">
            <div class="text-center printable-card">
                <h1 id="report-title" class="text-2xl sm:text-3xl font-extrabold text-gray-800">ë¦¬í¬íŠ¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h1>
                <p id="report-subtitle" class="mt-2 text-md text-gray-500"></p>
            </div>
            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm printable-card">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 text-center">
                    <div><p class="text-base text-gray-700">ì˜ˆìƒ <strong class="font-bold">ê¸ˆë¦¬</strong></p><p id="metric-interest-rate" class="text-2xl font-bold text-gray-800">-</p></div>
                    <div><p class="text-base text-gray-700">ëŒ€ì¶œ <strong class="font-bold">ê¸°ê°„</strong></p><p id="metric-loan-term" class="text-2xl font-bold text-gray-800">-</p></div>
                    <div class="col-span-1 sm:col-span-1"><p class="text-base text-gray-700">ìƒí™˜ ë°©ì‹</p><p id="metric-repayment-method" class="text-2xl font-bold text-gray-800">-</p></div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-4 printable-card">
                <div><h3 class="text-lg font-bold text-gray-800 mb-2">ëŒ€ì¶œ ë°©ì‹ íŠ¹ì§•</h3><p id="desc-features" class="text-gray-600 leading-relaxed"></p></div>
                <div class="border-t border-gray-100 pt-4"><h3 class="text-lg font-bold text-gray-800 mb-2">ì¶”ì²œ ëŒ€ìƒ</h3><p id="desc-recommended-for" class="text-gray-600 leading-relaxed"></p></div>
            </div>

            <div class="printable-card">
                <p class="text-xs text-gray-500 text-center bg-gray-200 p-4 rounded-lg">
                    â€» ë³¸ ë¦¬í¬íŠ¸ëŠ” ì˜ˆì‹œì´ë©°, ì‹¤ì œ ëŒ€ì¶œ ì¡°ê±´ì€ ê¸ˆìœµì‚¬ ì •ì±… ë° ê³ ê° ì‹ ìš©ë„, ë‹´ë³´ í‰ê°€ ê²°ê³¼ ë“±ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
                    ì •í™•í•œ ëŒ€ì¶œ í•œë„ ë° ê¸ˆë¦¬ëŠ” ìƒë‹´ í›„ í™•ì •ë©ë‹ˆë‹¤.
                </p>
            </div>

            <div id="comparison-container" class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm"><h3 class="text-lg font-bold text-gray-800 mb-4">ë‹¤ë¥¸ ëŒ€ì¶œ ë°©ì‹ê³¼ í•œëˆˆì— ë¹„êµí•˜ê¸°</h3><table class="w-full text-sm text-left text-gray-500"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th scope="col" class="px-6 py-3">êµ¬ë¶„</th><th scope="col" class="px-6 py-3">ì˜ˆìƒ ê¸ˆë¦¬</th><th scope="col" class="px-6 py-3">ëŒ€ì¶œ ê¸°ê°„</th></tr></thead><tbody id="comparison-body"></tbody></table></div>
            
            <!-- [ì—…ë°ì´íŠ¸] CTA ë²„íŠ¼ UX ê°œì„  -->
            <div id="cta-container" class="flex flex-col space-y-3 pt-4">
                <a href="https://fincettereport.kr/edit" onclick="handleCtaClick('edit')" data-variant="1" class="cta-button block w-full text-center px-4 py-3.5 text-base leading-snug font-semibold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 active:shadow-inner transition">
                    ğŸ”„ ì •ë³´ ìˆ˜ì •í•´ì„œ ë” ì •í™•í•˜ê²Œ í™•ì¸í•˜ê¸°
                </a>
                <a href="https://fincettereport.kr/choose" onclick="handleCtaClick('choose')" data-variant="2" class="cta-button block w-full text-center px-4 py-3.5 text-base leading-snug font-semibold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 active:shadow-inner transition">
                    ğŸ” í˜¹ì‹œ ë” ì¢‹ì€ ë°©ë²•ì´ ìˆì„ê¹Œ í™•ì¸í•˜ê¸°
                </a>
                <a href="https://fincettereport.kr/consult" onclick="handleCtaClick('consult')" data-variant="3" class="cta-button block w-full text-center px-4 py-3.5 text-base leading-snug font-bold text-white bg-blue-600 rounded-lg hover:bg-blue-700 active:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition shadow-md hover:shadow-lg">
                    ğŸ“ ì „ë¬¸ê°€ì—ê²Œ ë°”ë¡œ ë¬´ë£Œë¡œ í™•ì¸ë°›ê¸°
                </a>
            </div>

            <div id="print-container" class="text-center pt-4"><button onclick="downloadPDF()" title="PDF ì €ì¥" class="px-6 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>ë¦¬í¬íŠ¸ ì €ì¥ (PDF)</button></div>
        </div>
    </div>

    <script>
    try {
        const reportData = {
            "A": {
                "title": "Aì•ˆ - ì‚¬ì—…ìê¸ˆ ë¹ ë¥¸ í™•ë³´ ì„¤ê³„",
                "filename_prefix": "Aì•ˆ_ì‚¬ì—…ìê¸ˆ_ë¹ ë¥¸_í™•ë³´",
                "subtitle": "ì‚¬ì—…ìë¥¼ ìœ„í•œ 3~5ë…„ ë‹¨ê¸° ì£¼ë‹´ëŒ€, ìš´ì˜ìê¸ˆ ì‹ ì† í™•ë³´",
                "metrics": { "interestRate": "ì—° 4.9% ~ 14%", "loanTerm": "3ë…„ ~ 5ë…„", "repaymentMethod": "ë§Œê¸°ì¼ì‹œìƒí™˜" },
                "description": { "features": "ë‚´ ì§‘ì„ ë‹´ë³´ë¡œ ì‚¬ì—…ìê¸ˆì„ ë¹ ë¥´ê²Œ ë°›ì„ ìˆ˜ ìˆì–´ìš”. ë§¤ì›” ì´ìë§Œ ë‚´ë©´ ë˜ë‹ˆê¹Œ ë‹¹ì¥ ë¶€ë‹´ë„ ì ì–´ìš”.", "recommendedFor": "ë‹¹ì¥ ì‚¬ì—…ìê¸ˆì´ ê¸‰í•œ ê°œì¸ì‚¬ì—…ì" }
            },
            "B": {
                "title": "Bì•ˆ - ì•ˆì •ì  ì‹œì‘ + ë¯¸ë˜ ëŒ€ì‘ ì„¤ê³„",
                "filename_prefix": "Bì•ˆ_ì•ˆì •ì _ì‹œì‘_ë¯¸ë˜_ëŒ€ì‘",
                "subtitle": "ì²˜ìŒ 3~5ë…„ ê³ ì •ê¸ˆë¦¬ë¡œ ì•ˆì •, ì´í›„ ë³€ë™ê¸ˆë¦¬ë¡œ ê¸ˆë¦¬ í•˜ë½ í˜œíƒ",
                "metrics": { "interestRate": "ì—° 4.8% ~ 9%", "loanTerm": "15ë…„ ~ 30ë…„", "repaymentMethod": "ì›ë¦¬ê¸ˆê· ë“±" },
                "description": { "features": "ì²˜ìŒì—” ê³ ì •ê¸ˆë¦¬ë¡œ ì•ˆì •ì ìœ¼ë¡œ ê³„íšì„ ì„¸ìš°ê³ , ë‚˜ì¤‘ì—” ë³€ë™ê¸ˆë¦¬ë¡œ ë°”ë€Œì–´ ê¸ˆë¦¬ê°€ ë–¨ì–´ì§€ë©´ ë” ìœ ë¦¬í•´ì ¸ìš”.", "recommendedFor": "ì•ìœ¼ë¡œ ì†Œë“ì´ ëŠ˜ì–´ë‚  ì˜ˆì •ì¸ ë¶„, 5ë…„ ë‚´ ì´ì‚¬ ê³„íšì´ ìˆëŠ” ë¶„" }
            }
        };

        let currentReportOption = 'A';

        const elements = {
            title: document.getElementById('report-title'),
            subtitle: document.getElementById('report-subtitle'),
            interestRate: document.getElementById('metric-interest-rate'),
            loanTerm: document.getElementById('metric-loan-term'),
            repaymentMethod: document.getElementById('metric-repayment-method'),
            features: document.getElementById('desc-features'),
            recommendedFor: document.getElementById('desc-recommended-for'),
            optionButtons: document.querySelectorAll('.option-button'),
            comparisonBody: document.getElementById('comparison-body')
        };
        
        function downloadPDF() {
            const element = document.getElementById('report-content');
            const reportInfo = reportData[currentReportOption];
            const filename = `${reportInfo.filename_prefix}_í•€ì…‹ë¦¬í¬íŠ¸.pdf`;
            const opt = {
                margin:       0.5,
                filename:     filename,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true },
                jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
            };
            
            const hiddenElements = document.querySelectorAll('#selection-container, #cta-container, #print-container, #comparison-container');
            const originalDisplays = Array.from(hiddenElements).map(el => el.style.display);
            hiddenElements.forEach(el => el.style.display = 'none');

            html2pdf().set(opt).from(element).save().catch(err => {
                console.error("PDF ìƒì„± ì˜¤ë¥˜:", err);
                alert("PDFë¥¼ ìƒì„±í•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
            }).finally(() => {
                hiddenElements.forEach((el, index) => {
                    el.style.display = originalDisplays[index] || '';
                });
            });
        }

        function renderComparison(currentOption) {
            elements.comparisonBody.innerHTML = '';
            const options = ['A', 'B'];
            options.forEach(option => {
                const data = reportData[option];
                const isCurrent = option === currentOption;
                const row = document.createElement('tr');
                row.className = isCurrent ? 'bg-blue-50 border-b font-bold' : 'bg-white border-b hover:bg-gray-50';
                const simpleTitle = data.title.split(' - ')[0];
                row.innerHTML = `<td class="px-6 py-4">${simpleTitle} ${isCurrent ? '(í˜„ì¬ ì„ íƒ)' : ''}</td><td class="px-6 py-4">${data.metrics.interestRate}</td><td class="px-6 py-4">${data.metrics.loanTerm}</td>`;
                elements.comparisonBody.appendChild(row);
            });
        }

        function renderReport(option) {
            try {
                currentReportOption = option;
                const data = reportData[option];
                if (!data) return;
                
                document.title = `${data.title} - í•€ì…‹ë¦¬í¬íŠ¸`;
                elements.title.textContent = data.title;
                elements.subtitle.textContent = data.subtitle;
                elements.interestRate.textContent = data.metrics.interestRate;
                elements.loanTerm.textContent = data.metrics.loanTerm;
                elements.repaymentMethod.textContent = data.metrics.repaymentMethod;
                elements.features.textContent = data.description.features;
                elements.recommendedFor.textContent = data.description.recommendedFor;
                
                elements.optionButtons.forEach(button => {
                    if (button.textContent.includes(option)) {
                        button.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                        button.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                    } else {
                        button.classList.remove('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                        button.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                    }
                });
                renderComparison(option);
            } catch (error) {
                console.error(`${option} ë°©ì‹ ë¦¬í¬íŠ¸ë¥¼ ë Œë”ë§í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:`, error);
            }
        }
        
        // [ì—…ë°ì´íŠ¸] CTA í´ë¦­ ì´ë²¤íŠ¸ ì¶”ì  í•¨ìˆ˜
        function handleCtaClick(ctaType) {
            console.log(`CTA ë²„íŠ¼ í´ë¦­: ${ctaType}`);
            // ì—¬ê¸°ì— Firestoreì— ctaClicked: true ì—…ë°ì´íŠ¸ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
            // ì˜ˆ: updateDoc(doc(db, "reports", currentReportId), { ctaClicked: true, ctaType: ctaType });
        }
        
        window.renderReport = renderReport;
        window.downloadPDF = downloadPDF;

        document.addEventListener('DOMContentLoaded', (event) => {
            const urlParams = new URLSearchParams(window.location.search);
            const initialOption = urlParams.get('option') || 'A';
            renderReport(initialOption);
        });

    } catch (error) {
        console.error("ìŠ¤í¬ë¦½íŠ¸ ì „ì²´ì— ì¹˜ëª…ì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:", error);
    }
    </script>

</body>
</html>
