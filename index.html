<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>핀셋리포트 - 상세 대출 설계안</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif !important;
        }
        @media print {
            body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }
            .printable-card { margin-bottom: 32px !important; page-break-inside: avoid; break-inside: avoid; }
        }
    </style>
</head>
<body class="bg-gray-50">

    <div class="container mx-auto max-w-3xl p-4 sm:p-8">
        
        <div id="selection-container" class="mb-8 p-4 bg-white rounded-xl shadow-sm border border-gray-200">
            <h2 class="text-lg font-semibold text-center mb-4 text-gray-700">리포트 방식 선택</h2>
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                <button onclick="renderReport('A')" class="option-button w-full p-3 font-semibold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition">A: 사업자 주담대</button>
                <button onclick="renderReport('B')" class="option-button w-full p-3 font-semibold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition">B: 일반 주담대</button>
            </div>
        </div>

        <!-- 리포트가 표시될 영역 -->
        <div id="report-content" class="space-y-6">
            <div class="text-center printable-card">
                <h1 id="report-title" class="text-3xl sm:text-4xl font-extrabold text-gray-800">리포트를 선택해주세요</h1>
                <p id="report-subtitle" class="mt-2 text-md text-gray-500"></p>
            </div>
            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm printable-card">
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 text-center">
                    <div><p class="text-sm text-gray-500">예상 <strong class="text-gray-700">금리</strong></p><p id="metric-interest-rate" class="text-2xl font-bold text-gray-800">-</p></div>
                    <div><p class="text-sm text-gray-500">대출 <strong class="text-gray-700">기간</strong></p><p id="metric-loan-term" class="text-2xl font-bold text-gray-800">-</p></div>
                    <div class="col-span-1 sm:col-span-1"><p class="text-sm text-gray-500">상환 방식</p><p id="metric-repayment-method" class="text-2xl font-bold text-gray-800">-</p></div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm space-y-4 printable-card">
                <div><h3 class="text-lg font-bold text-gray-800 mb-2">대출 방식 특징</h3><p id="desc-features" class="text-gray-600 leading-relaxed"></p></div>
                <div class="border-t border-gray-100 pt-4"><h3 class="text-lg font-bold text-gray-800 mb-2">추천 대상</h3><p id="desc-recommended-for" class="text-gray-600 leading-relaxed"></p></div>
            </div>

            <div class="printable-card">
                <p class="text-xs text-gray-500 text-center bg-gray-100 p-4 rounded-lg">
                    ※ 본 리포트는 예시이며, 실제 대출 조건은 금융사 정책 및 고객 신용도, 담보 평가 결과 등에 따라 달라질 수 있습니다.  
                    정확한 대출 한도 및 금리는 상담 후 확정됩니다.
                </p>
            </div>

            <div id="comparison-container" class="bg-white p-6 rounded-xl border border-gray-200 shadow-sm"><h3 class="text-lg font-bold text-gray-800 mb-4">다른 대출 방식과 한눈에 비교하기</h3><table class="w-full text-sm text-left text-gray-500"><thead class="text-xs text-gray-700 uppercase bg-gray-50"><tr><th scope="col" class="px-6 py-3">구분</th><th scope="col" class="px-6 py-3">예상 금리</th><th scope="col" class="px-6 py-3">대출 기간</th></tr></thead><tbody id="comparison-body"></tbody></table></div>
            <div id="cta-container" class="grid grid-cols-1 sm:grid-cols-3 gap-4"><a href="https://fincettereport.kr/edit" target="_blank" class="block w-full p-4 font-semibold text-gray-700 text-center bg-gray-200 rounded-lg hover:bg-gray-300 transition underline">내 정보 다시 입력하기</a><a href="https://fincettereport.kr/choose" target="_blank" class="block w-full p-4 font-semibold text-gray-700 text-center bg-gray-200 rounded-lg hover:bg-gray-300 transition underline">다른 방식 보기</a><a href="https://fincettereport.kr/consult" target="_blank" class="block w-full p-4 font-bold text-white text-center bg-blue-600 rounded-lg hover:bg-blue-700 transition underline">전문가 상담 신청</a></div>
            <div id="print-container" class="text-center pt-4"><button onclick="downloadPDF()" title="PDF 저장" class="px-6 py-2 text-sm text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>리포트 저장 (PDF)</button></div>
        </div>
    </div>

    <script>
    try {
        // [업데이트] 데이터 객체에 파일명 접두사 추가
        const reportData = {
            "A": {
                "title": "A안 - 단기 운영자금 확보 설계",
                "filename_prefix": "A안_단기_운영자금",
                "subtitle": "사업자 대상, 3~5년 단기 주담대로 운영자금 빠르게 확보",
                "metrics": { "interestRate": "연 4.9% ~ 14%", "loanTerm": "3년 ~ 5년", "repaymentMethod": "만기일시상환" },
                "description": { "features": "사업자를 대상으로 주택을 담보로 하여 비교적 빠르게 운영 자금을 확보할 수 있는 대출 방식입니다. 매월 이자만 납부하여 부담이 적습니다.", "recommendedFor": "사업 운영 자금이 급히 필요한 개인사업자" }
            },
            "B": {
                "title": "B안 - 초기 안정 + 미래 유연 설계",
                "filename_prefix": "B안_초기안정_미래유연",
                "subtitle": "초기 3~5년 고정금리 후 변동금리로 전환, 금리 하락기 대응",
                "metrics": { "interestRate": "연 4.8% ~ 9%", "loanTerm": "15년 ~ 30년", "repaymentMethod": "원리금균등" },
                "description": { "features": "초기에는 고정금리로 안정적인 상환 계획을 세우고, 이후 변동금리로 전환하여 금리 하락기의 혜택을 기대할 수 있는 혼합형 방식입니다.", "recommendedFor": "소득 증가가 예정된 분, 5년 내 거주지를 이동할 계획이 있는 분" }
            }
        };

        let currentReportOption = 'A'; // 현재 선택된 옵션을 저장할 전역 변수

        const elements = {
            title: document.getElementById('report-title'),
            subtitle: document.getElementById('report-subtitle'),
            interestRate: document.getElementById('metric-interest-rate'),
            loanTerm: document.getElementById('metric-loan-term'),
            repaymentMethod: document.getElementById('metric-repayment-method'),
            features: document.getElementById('desc-features'),
            recommendedFor: document.getElementById('desc-recommended-for'),
            optionButtons: document.querySelectorAll('.option-button'),
            comparisonBody: document.getElementById('comparison-body')
        };
        
        // [업데이트] PDF 다운로드 함수 수정
        function downloadPDF() {
            const element = document.getElementById('report-content');
            const reportInfo = reportData[currentReportOption];
            // [수정 1] 파일명 커스터마이징
            const filename = `${reportInfo.filename_prefix}_핀셋리포트.pdf`;

            const opt = {
                margin:       0.5,
                filename:     filename,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true },
                jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
            };
            
            const hiddenElements = document.querySelectorAll('#selection-container, #cta-container, #print-container, #comparison-container');
            // [수정 2] UI 재노출 속도 향상을 위해 원래 display 속성을 저장
            const originalDisplays = Array.from(hiddenElements).map(el => el.style.display);

            hiddenElements.forEach(el => el.style.display = 'none');

            // .then()은 딜레이가 아니며, PDF 생성이 완료된 직후 코드를 실행하는 가장 빠른 방식입니다.
            html2pdf().set(opt).from(element).save().catch(err => {
                console.error("PDF 생성 오류:", err);
                alert("PDF를 생성하는 데 문제가 발생했습니다.");
            }).finally(() => {
                // 성공/실패 여부와 관계없이 항상 UI를 원래대로 복구합니다.
                hiddenElements.forEach((el, index) => {
                    el.style.display = originalDisplays[index] || ''; // 저장된 원래 값으로 복원
                });
            });
        }

        function renderComparison(currentOption) {
            elements.comparisonBody.innerHTML = '';
            const options = ['A', 'B'];
            options.forEach(option => {
                const data = reportData[option];
                const isCurrent = option === currentOption;
                const row = document.createElement('tr');
                row.className = isCurrent ? 'bg-blue-50 border-b font-bold' : 'bg-white border-b hover:bg-gray-50';
                const simpleTitle = data.title.split(' - ')[0];
                row.innerHTML = `<td class="px-6 py-4">${simpleTitle} ${isCurrent ? '(현재 선택)' : ''}</td><td class="px-6 py-4">${data.metrics.interestRate}</td><td class="px-6 py-4">${data.metrics.loanTerm}</td>`;
                elements.comparisonBody.appendChild(row);
            });
        }

        function renderReport(option) {
            try {
                currentReportOption = option; // 현재 선택된 옵션 업데이트
                const data = reportData[option];
                if (!data) return;
                
                document.title = `${data.title} - 핀셋리포트`;
                elements.title.textContent = data.title;
                elements.subtitle.textContent = data.subtitle;
                elements.interestRate.textContent = data.metrics.interestRate;
                elements.loanTerm.textContent = data.metrics.loanTerm;
                elements.repaymentMethod.textContent = data.metrics.repaymentMethod;
                elements.features.textContent = data.description.features;
                elements.recommendedFor.textContent = data.description.recommendedFor;
                
                elements.optionButtons.forEach(button => {
                    if (button.textContent.includes(option)) {
                        button.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                        button.classList.add('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                    } else {
                        button.classList.remove('bg-blue-600', 'text-white', 'hover:bg-blue-700');
                        button.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                    }
                });
                renderComparison(option);
            } catch (error) {
                console.error(`${option} 방식 리포트를 렌더링하는 중 오류 발생:`, error);
            }
        }
        
        window.renderReport = renderReport;
        window.downloadPDF = downloadPDF;

        document.addEventListener('DOMContentLoaded', (event) => {
            const urlParams = new URLSearchParams(window.location.search);
            const initialOption = urlParams.get('option') || 'A';
            renderReport(initialOption);
        });

    } catch (error) {
        console.error("스크립트 전체에 치명적인 오류가 발생했습니다:", error);
    }
    </script>

</body>
</html>
